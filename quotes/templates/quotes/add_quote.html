{% extends "quotes/base.html" %}
{% block title %}Добавить цитату{% endblock %}
{% block content %}
<div class="card">
    <h3 style="margin-top:0;">Добавить цитату</h3>

    <form method="post" class="styled-form" novalidate>
        {% csrf_token %}

        {% if form.is_duplicate %}
            <div class="form-errors" role="alert">
                <p>❌ <strong>Ошибка:</strong> Такая цитата уже существует.</p>
                {% if form.duplicate_quote %}
                    <blockquote style="border-left: 3px solid var(--neon-red); padding-left: 10px; margin: 10px 0 0 0;">
                        <em>“{{ form.duplicate_quote }}”</em>
                    </blockquote>
                {% endif %}
                <p style="margin-top:10px;">Добавление дубликата невозможно.</p>
            </div>
        {% endif %}

        {% if form.similar_quote %}
            <div class="form-warning" role="alert">
                <p>⚠️ <strong>Предупреждение:</strong> Найдена очень похожая цитата:</p>
                <blockquote style="border-left: 3px solid #fbbf24; padding-left: 10px; margin: 10px 0 0 0;">
                    <em>“{{ form.similar_quote }}”</em>
                </blockquote>
                <p style="margin-top:10px;">Вы уверены, что хотите добавить свою версию?</p>
            </div>
            <input type="hidden" name="confirm_add" value="true">
        {% endif %}

        {% if form.non_field_errors and not form.similar_quote %}
            <div class="form-errors" role="alert">
                {% for error in form.non_field_errors %}
                    <p>❌ {{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        {# === Поля формы === #}
        <div class="form-field">
            <label for="{{ form.text.id_for_label }}">Текст цитаты</label>
            {{ form.text }}
            {% if form.text.errors and not form.is_duplicate %}
                <div class="form-errors" role="alert" style="margin-top:10px;">
                    {% for error in form.text.errors %}
                        <p>❌ {{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-field">
            <label for="{{ form.source_name.id_for_label }}">Источник</label>
            {{ form.source_name }}
            {% if form.source_name.errors %}
                <div class="form-errors" role="alert" style="margin-top:10px;">
                    {% for error in form.source_name.errors %}
                        <p>❌ {{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-field">
            <label for="{{ form.source_kind.id_for_label }}">Тип источника</label>
            {{ form.source_kind }}
            {% if form.source_kind.errors %}
                <div class="form-errors" role="alert" style="margin-top:10px;">
                    {% for error in form.source_kind.errors %}
                        <p>❌ {{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-field">
            {{ form.weight }}
            {% if form.weight.errors %}
                <div class="form-errors" role="alert" style="margin-top:10px;">
                    {% for error in form.weight.errors %}
                        <p>❌ {{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        {% if form.similar_quote %}
            <button type="submit">Да, добавить мою версию</button>
        {% else %}
            <button type="submit">Сохранить</button>
        {% endif %}
    </form>
</div>
{% endblock %}
